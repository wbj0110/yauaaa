#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2019 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
config:

- lookup:
    name: 'MSOfficeApplicationNames'
    map:
      "MAPI"   : "Microsoft Office MAPI Client" # Messaging Application Programming Interface (MAPI)
      "UCMAPI" : "Microsoft Office MAPI Client" # Messaging Application Programming Interface (MAPI)
      "InfoPath Editor" : "Microsoft Office InfoPath Editor"

- matcher:
    extract:
    - 'DeviceClass                         :      1 : "Desktop"'
    - 'AgentClass                          :      9 : "Special"'
    - 'AgentName                           :      9 : "Microsoft Office"'
    - 'AgentVersion                        :      9 : agent.(1)product.(1)name="Microsoft Office"^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)name="Microsoft Office"'
    variable:
    - 'OfficeAppName: agent.(1)product.(1)comments.entry.product.name{"Microsoft "'
    extract:
    - 'DeviceClass                         :      1 : "Desktop"'
    - 'AgentClass                          :     10 : "Special"'
    - 'AgentName                           :     10 : @OfficeAppName'
    - 'AgentVersion                        :     10 : @OfficeAppName^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)name="Microsoft Office"'
    variable:
    - 'OfficeAppName: LookUp[MSOfficeApplicationNames;agent.(1)product.(1)comments.entry.product.name]'
    extract:
    - 'DeviceClass                         :      1 : "Desktop"'
    - 'AgentClass                          :     10 : "Special"'
    - 'AgentName                           :     11 : @OfficeAppName'
    - 'AgentVersion                        :     10 : @OfficeAppName^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.name="Microsoft Outlook"'
    extract:
    - 'AgentClass                          :    100 :"Email Client"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.name="MAPI"'
    extract:
    - 'AgentClass                          :    100 :"Email Client"'


# Ensure that 'pro' is not detected as the language
#   "pro" : "Old Proven√ßal (to 1500)"
- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Microsoft Outlook 16.0.8241; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Unknown'
      DeviceBrand                          : 'Unknown'
      OperatingSystemClass                 : 'Unknown'
      OperatingSystemName                  : 'Unknown'
      OperatingSystemVersion               : '??'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Microsoft Outlook'
      AgentVersion                         : '16.0.8241'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Outlook 16.0.8241'
      AgentNameVersionMajor                : 'Microsoft Outlook 16'




- test:
    input:
      user_agent_string: 'Microsoft Office/16.0'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Unknown'
      DeviceBrand                          : 'Unknown'
      OperatingSystemClass                 : 'Unknown'
      OperatingSystemName                  : 'Unknown'
      OperatingSystemVersion               : '??'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Office'
      AgentVersion                         : '16.0'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Office 16.0'
      AgentNameVersionMajor                : 'Microsoft Office 16'

- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; InfoPath Editor 15.0.5059; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Office InfoPath Editor'
      AgentVersion                         : '15.0.5059'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft Office InfoPath Editor 15.0.5059'
      AgentNameVersionMajor                : 'Microsoft Office InfoPath Editor 15'


- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; Microsoft Excel 15.0.5031; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Excel'
      AgentVersion                         : '15.0.5031'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft Excel 15.0.5031'
      AgentNameVersionMajor                : 'Microsoft Excel 15'


- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; Microsoft Lync 15.0.5059; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Lync'
      AgentVersion                         : '15.0.5059'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft Lync 15.0.5059'
      AgentNameVersionMajor                : 'Microsoft Lync 15'


- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; Microsoft OneNote 15.0.5059; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft OneNote'
      AgentVersion                         : '15.0.5059'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft OneNote 15.0.5059'
      AgentNameVersionMajor                : 'Microsoft OneNote 15'


- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; Microsoft Outlook 15.0.5059; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Microsoft Outlook'
      AgentVersion                         : '15.0.5059'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft Outlook 15.0.5059'
      AgentNameVersionMajor                : 'Microsoft Outlook 15'


- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; Microsoft PowerPoint 15.0.5059; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft PowerPoint'
      AgentVersion                         : '15.0.5059'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft PowerPoint 15.0.5059'
      AgentNameVersionMajor                : 'Microsoft PowerPoint 15'



- test:
    input:
      user_agent_string: 'Microsoft Office/15.0 (Windows NT 10.0; Microsoft Word 15.0.5059; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Word'
      AgentVersion                         : '15.0.5059'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Microsoft Word 15.0.5059'
      AgentNameVersionMajor                : 'Microsoft Word 15'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Microsoft Outlook 16.0.10827; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Unknown'
      DeviceBrand                          : 'Unknown'
      OperatingSystemClass                 : 'Unknown'
      OperatingSystemName                  : 'Unknown'
      OperatingSystemVersion               : '??'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Microsoft Outlook'
      AgentVersion                         : '16.0.10827'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Outlook 16.0.10827'
      AgentNameVersionMajor                : 'Microsoft Outlook 16'


# Broken: No application name --> Hence the generic answer "Office"
- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0;  16.0.10730; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Office'
      AgentVersion                         : '16.0'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Office 16.0'
      AgentNameVersionMajor                : 'Microsoft Office 16'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; MAPI 16.0.10827; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Microsoft Office MAPI Client'
      AgentVersion                         : '16.0.10827'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Office MAPI Client 16.0.10827'
      AgentNameVersionMajor                : 'Microsoft Office MAPI Client 16'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; Microsoft Access 16.0.10730; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Access'
      AgentVersion                         : '16.0.10730'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Access 16.0.10730'
      AgentNameVersionMajor                : 'Microsoft Access 16'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; Microsoft Project 16.0.10730; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Project'
      AgentVersion                         : '16.0.10730'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Project 16.0.10730'
      AgentNameVersionMajor                : 'Microsoft Project 16'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; Microsoft Visio 16.0.10730; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Visio'
      AgentVersion                         : '16.0.10730'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Visio 16.0.10730'
      AgentNameVersionMajor                : 'Microsoft Visio 16'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; Microsoft Word 16.0.10730; Converter)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Word'
      AgentVersion                         : '16.0.10730'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Word 16.0.10730'
      AgentNameVersionMajor                : 'Microsoft Word 16'

- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; Microsoft Word 16.0.10827; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Word'
      AgentVersion                         : '16.0.10827'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Word 16.0.10827'
      AgentNameVersionMajor                : 'Microsoft Word 16'


- test:
    input:
      user_agent_string: 'Microsoft Office/16.0 (Windows NT 10.0; ucmapi 16.0.4738; Pro)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Microsoft Office MAPI Client'
      AgentVersion                         : '16.0.4738'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'Microsoft Office MAPI Client 16.0.4738'
      AgentNameVersionMajor                : 'Microsoft Office MAPI Client 16'

# -----------------------------------------------------------------------------------------------------------------
# GoogleDocs:

- lookup:
    name: 'GoogleDocsApps'
    map:
      "apps-spreadsheets":  "Google Docs Spreadsheets"
      "apps-presentations": "Google Docs Presentations"
      "documents":          "Google Docs Documents"
      "script":             "Google Docs Script"

- matcher:
    require:
    - 'agent.(1)product.(1)comments.(1)entry="compatible"'
    - 'agent.(1)product.(1)comments.(2)entry="GoogleDocs"'
    - 'agent.(1)product.(1)comments.(4)entry="http://docs.google.com"'
    extract:
    - 'DeviceClass                         :    101 : "Desktop"' # Actually; it can be anything. We don't know.
    - 'DeviceName                          :    101 : "Google Docs"'
    - 'DeviceBrand                         :    101 : "Google"'
    - 'OperatingSystemClass                :    101 : "Cloud"'
    - 'OperatingSystemName                 :    101 : "Google Cloud"'
    - 'OperatingSystemVersion              :    101 : "??"'
    - 'LayoutEngineClass                   :    101 : "Cloud"'
    - 'LayoutEngineName                    :    101 : "Cloud"'
    - 'LayoutEngineVersion                 :    101 : "??"'
    - 'AgentClass                          :    101 : "Cloud Application"'
    - 'AgentName                           :    101 : LookUp[GoogleDocsApps;agent.(1)product.(1)comments.(3)entry]'
    - 'AgentVersion                        :    101 : "??"'


- matcher:
    require:
    - 'agent.(1)product.(1)comments.(1)entry="compatible"'
    - 'agent.(1)product.(1)comments.(2)entry="GoogleDocs"'
    - 'agent.(1)product.(1)comments.(4)entry="http://docs.google.com"'
    extract:
    - 'DeviceClass                         :    100 : "Desktop"' # Actually; it can be anything. We don't know.
    - 'DeviceName                          :    100 : "Google Docs"'
    - 'DeviceBrand                         :    100 : "Google"'
    - 'OperatingSystemClass                :    100 : "Cloud"'
    - 'OperatingSystemName                 :    100 : "Google Cloud"'
    - 'OperatingSystemVersion              :    100 : "??"'
    - 'LayoutEngineClass                   :    100 : "Cloud"'
    - 'LayoutEngineName                    :    100 : "Cloud"'
    - 'LayoutEngineVersion                 :    100 : "??"'
    - 'AgentClass                          :    100 : "Cloud Application"'
    - 'AgentName                           :    100 : agent.(1)product.(1)comments.(3)entry'
    - 'AgentVersion                        :    100 : "??"'


# Google Docs Sheet (both via website and android app): Put this in cell: =IMAGE("https://niels.basjes.nl/Pasfoto-vierkant.jpg")

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; GoogleDocs; apps-spreadsheets; +http://docs.google.com)'
    expected:
      DeviceClass                          : 'Desktop' # Actually; it can be anything. We don't know.
      DeviceName                           : 'Google Docs'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Google Cloud'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Google Cloud ??'
      LayoutEngineClass                    : 'Cloud'
      LayoutEngineName                     : 'Cloud'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Cloud ??'
      LayoutEngineNameVersionMajor         : 'Cloud ??'
      AgentClass                           : 'Cloud Application'
      AgentName                            : 'Google Docs Spreadsheets'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Docs Spreadsheets ??'
      AgentNameVersionMajor                : 'Google Docs Spreadsheets ??'
      AgentInformationUrl                  : 'http://docs.google.com'

# Chrome 71 on Ubuntu 16.04:
# Google Docs Sheet: Insert --> Image --> By Url .
#- test: #TODO: Implement
#    input:
#      user_agent_string: 'Mozilla/5.0 (Windows NT 5.1; rv:11.0) Gecko Firefox/11.0 (via ggpht.com GoogleImageProxy)'
#    expected:
#      DeviceClass                          : 'Desktop'
#      DeviceName                           : 'Desktop'
#      DeviceBrand                          : 'Ggpht'
#      DeviceCpuBits                        : '32'
#      OperatingSystemClass                 : 'Desktop'
#      OperatingSystemName                  : 'Windows NT'
#      OperatingSystemVersion               : 'XP'
#      OperatingSystemNameVersion           : 'Windows XP'
#      LayoutEngineClass                    : 'Browser'
#      LayoutEngineName                     : 'Mozilla'
#      LayoutEngineVersion                  : '5.0'
#      LayoutEngineVersionMajor             : '5'
#      LayoutEngineNameVersion              : 'Mozilla 5.0'
#      LayoutEngineNameVersionMajor         : 'Mozilla 5'
#      AgentClass                           : 'Browser'
#      AgentName                            : 'Firefox'
#      AgentVersion                         : '11.0'
#      AgentVersionMajor                    : '11'
#      AgentNameVersion                     : 'Firefox 11.0'
#      AgentNameVersionMajor                : 'Firefox 11'
#      AgentInformationUrl                  : 'ggpht.com'

# Chrome 71 on Ubuntu 16.04:
# Google Docs document: Insert --> Image --> By Url .
# Duplicate: 'Mozilla/5.0 (Windows NT 5.1; rv:11.0) Gecko Firefox/11.0 (via ggpht.com GoogleImageProxy)'
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; GoogleDocs; documents; +http://docs.google.com)'
    expected:
      DeviceClass                          : 'Desktop' # Actually; it can be anything. We don't know.
      DeviceName                           : 'Google Docs'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Google Cloud'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Google Cloud ??'
      LayoutEngineClass                    : 'Cloud'
      LayoutEngineName                     : 'Cloud'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Cloud ??'
      LayoutEngineNameVersionMajor         : 'Cloud ??'
      AgentClass                           : 'Cloud Application'
      AgentName                            : 'Google Docs Documents'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Docs Documents ??'
      AgentNameVersionMajor                : 'Google Docs Documents ??'
      AgentInformationUrl                  : 'http://docs.google.com'

# Google Docs presentation: Insert --> Image --> By Url .
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; GoogleDocs; apps-presentations; +http://docs.google.com)'
    expected:
      DeviceClass                          : 'Desktop' # Actually; it can be anything. We don't know.
      DeviceName                           : 'Google Docs'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Google Cloud'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Google Cloud ??'
      LayoutEngineClass                    : 'Cloud'
      LayoutEngineName                     : 'Cloud'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Cloud ??'
      LayoutEngineNameVersionMajor         : 'Cloud ??'
      AgentClass                           : 'Cloud Application'
      AgentName                            : 'Google Docs Presentations'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Docs Presentations ??'
      AgentNameVersionMajor                : 'Google Docs Presentations ??'
      AgentInformationUrl                  : 'http://docs.google.com'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.(2)entry="GoogleApps script"'
    extract:
    - 'DeviceClass                         :    110 : "Desktop"' # Actually; it can be anything. We don't know.
    - 'DeviceName                          :    110 : "Google Docs"'
    - 'DeviceBrand                         :    110 : "Google"'
    - 'OperatingSystemClass                :    110 : "Cloud"'
    - 'OperatingSystemName                 :    110 : "Google Cloud"'
    - 'OperatingSystemVersion              :    110 : "??"'
    - 'LayoutEngineClass                   :    110 : "Cloud"'
    - 'LayoutEngineName                    :    110 : "Cloud"'
    - 'LayoutEngineVersion                 :    110 : "??"'
    - 'AgentClass                          :    110 : "Cloud Application"'
    - 'AgentName                           :    110 : "Google Docs Script"'
    - 'AgentVersion                        :    110 : "??"'


# GoogleDocs script; https://rehmann.co/blog/googleapps-script-bot/
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; GoogleApps script; +http://script.google.com/bot.html)'
    expected:
      DeviceClass                          : 'Desktop' # Actually; it can be anything. We don't know.
      DeviceName                           : 'Google Docs'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Google Cloud'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Google Cloud ??'
      LayoutEngineClass                    : 'Cloud'
      LayoutEngineName                     : 'Cloud'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Cloud ??'
      LayoutEngineNameVersionMajor         : 'Cloud ??'
      AgentClass                           : 'Cloud Application'
      AgentName                            : 'Google Docs Script'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Docs Script ??'
      AgentNameVersionMajor                : 'Google Docs Script ??'
      AgentInformationUrl                  : 'http://script.google.com/bot.html'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.(2)entry="Google-Apps-Script"'
    extract:
    - 'DeviceClass                         :    100 : "Desktop"' # Actually; it can be anything. We don't know.
    - 'DeviceName                          :    100 : "Google Docs"'
    - 'DeviceBrand                         :    100 : "Google"'
    - 'OperatingSystemClass                :    100 : "Cloud"'
    - 'OperatingSystemName                 :    100 : "Google Cloud"'
    - 'OperatingSystemVersion              :    100 : "??"'
    - 'LayoutEngineClass                   :    100 : "Cloud"'
    - 'LayoutEngineName                    :    100 : "Cloud"'
    - 'LayoutEngineVersion                 :    100 : "??"'
    - 'AgentClass                          :    100 : "Cloud Application"'
    - 'AgentName                           :    100 : "Google Docs Script"'
    - 'AgentVersion                        :    100 : "??"'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; Google-Apps-Script)'
    expected:
      DeviceClass                          : 'Desktop' # Actually; it can be anything. We don't know.
      DeviceName                           : 'Google Docs'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Google Cloud'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Google Cloud ??'
      LayoutEngineClass                    : 'Cloud'
      LayoutEngineName                     : 'Cloud'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Cloud ??'
      LayoutEngineNameVersionMajor         : 'Cloud ??'
      AgentClass                           : 'Cloud Application'
      AgentName                            : 'Google Docs Script'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Docs Script ??'
      AgentNameVersionMajor                : 'Google Docs Script ??'

# From https://stackoverflow.com/questions/15067462/urlfetch-with-custom-user-agent-string
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; GoogleDocs; script; +http://docs.google.com)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Google Docs'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Google Cloud'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Google Cloud ??'
      LayoutEngineClass                    : 'Cloud'
      LayoutEngineName                     : 'Cloud'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Cloud ??'
      LayoutEngineNameVersionMajor         : 'Cloud ??'
      AgentClass                           : 'Cloud Application'
      AgentName                            : 'Google Docs Script'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Docs Script ??'
      AgentNameVersionMajor                : 'Google Docs Script ??'
      AgentInformationUrl                  : 'http://docs.google.com'



# -----------------------------------------------------------------------------------------------------------------
# Lotus notes

- matcher:
    extract:
    - 'AgentClass                          :    100 :"Email Client"'
    - 'AgentName                           :    100 :"Lotus-Notes"'
    - 'AgentVersion                        :    100 :agent.(1)product.(1)comments.entry.(1)product.name="Lotus-Notes"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; Lotus-Notes/6.0; Windows-NT)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Windows NT ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Mozilla'
      LayoutEngineVersion                  : '4.0'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Mozilla 4.0'
      LayoutEngineNameVersionMajor         : 'Mozilla 4'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Lotus-Notes'
      AgentVersion                         : '6.0'
      AgentVersionMajor                    : '6'
      AgentNameVersion                     : 'Lotus-Notes 6.0'
      AgentNameVersionMajor                : 'Lotus-Notes 6'

# Thunderbird
- matcher:
    extract:
    - 'AgentClass                          :   2100 :"Email Client"'
    - 'AgentName                           :   2100 :"Thunderbird"'
    - 'AgentVersion                        :   2100 :agent.product.name="Thunderbird"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1.14) Gecko/20080505 Thunderbird/2.0.0.14'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Linux Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpu                            : 'Intel i686'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Linux'
      OperatingSystemVersion               : 'Intel i686'
      OperatingSystemNameVersion           : 'Linux Intel i686'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '1.8.1.14'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Gecko 1.8.1.14'
      LayoutEngineNameVersionMajor         : 'Gecko 1'
      LayoutEngineBuild                    : '20080505'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Thunderbird'
      AgentVersion                         : '2.0.0.14'
      AgentVersionMajor                    : '2'
      AgentNameVersion                     : 'Thunderbird 2.0.0.14'
      AgentNameVersionMajor                : 'Thunderbird 2'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.8.1.19) Gecko/20081209 Thunderbird/2.0.0.19'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Vista'
      OperatingSystemNameVersion           : 'Windows Vista'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '1.8.1.19'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Gecko 1.8.1.19'
      LayoutEngineNameVersionMajor         : 'Gecko 1'
      LayoutEngineBuild                    : '20081209'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Thunderbird'
      AgentVersion                         : '2.0.0.19'
      AgentVersionMajor                    : '2'
      AgentNameVersion                     : 'Thunderbird 2.0.0.19'
      AgentNameVersionMajor                : 'Thunderbird 2'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

# Lightning is a calendar addon for THunderbird
# https://addons.mozilla.org/nl/thunderbird/addon/lightning/
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows; U; Windows NT 5.1; cs; rv:1.9.1.8) Gecko/20100227 Lightning/1.0b1 Thunderbird/3.0.3'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'XP'
      OperatingSystemNameVersion           : 'Windows XP'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '1.9.1.8'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Gecko 1.9.1.8'
      LayoutEngineNameVersionMajor         : 'Gecko 1'
      LayoutEngineBuild                    : '20100227'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Thunderbird'
      AgentVersion                         : '3.0.3'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'Thunderbird 3.0.3'
      AgentNameVersionMajor                : 'Thunderbird 3'
      AgentLanguage                        : 'Czech'
      AgentLanguageCode                    : 'cs'
      AgentSecurity                        : 'Strong security'

# ThunderBrowse is a webbrowsing addon for Thunderbird
# https://addons.mozilla.org/nl/thunderbird/addon/thunderbrowse/
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2.8) Gecko/20100802 Lightning/1.0b2 Thunderbird/3.1.2 ThunderBrowse/3.3.2'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'XP'
      OperatingSystemNameVersion           : 'Windows XP'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '1.9.2.8'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Gecko 1.9.2.8'
      LayoutEngineNameVersionMajor         : 'Gecko 1'
      LayoutEngineBuild                    : '20100802'
      AgentClass                           : 'Email Client'
      AgentName                            : 'Thunderbird'
      AgentVersion                         : '3.1.2'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'Thunderbird 3.1.2'
      AgentNameVersionMajor                : 'Thunderbird 3'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows NT 6.1; WOW64) SkypeUriPreview Preview/0.5'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '7'
      OperatingSystemNameVersion           : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Mozilla'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Mozilla 5.0'
      LayoutEngineNameVersionMajor         : 'Mozilla 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'SkypeUriPreview Preview'
      AgentVersion                         : '0.5'
      AgentVersionMajor                    : '0'
      AgentNameVersion                     : 'SkypeUriPreview Preview 0.5'
      AgentNameVersionMajor                : 'SkypeUriPreview Preview 0'


- matcher:
    variable:
    - 'Dell: agent.product.comments.entry.product.name[1]="Dell"@'
    extract:
    - 'DeviceClass                         :   1000 : "Desktop"'
    - 'DeviceName                          :   1000 : @Dell^'
    - 'DeviceBrand                         :   1000 : @Dell'


- test:
    input:
      user_agent_string: 'OneNote/16.0.8431.2110 (Windows/10.0; Desktop x64; nl-NL; Desktop app; Dell Inc./Latitude 7480)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Dell Inc. /Latitude 7480' #FIXME: Get rid of the '/'
      DeviceBrand                          : 'Dell Inc.'
      DeviceCpu                            : 'x64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'OneNote'
      AgentVersion                         : '16.0.8431.2110'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'OneNote 16.0.8431.2110'
      AgentNameVersionMajor                : 'OneNote 16'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'


- test:
    input:
      user_agent_string: 'OneNote/16.0.8431.2110 (Windows/10.0; Desktop x64; nl-NL; Desktop app; Dell Inc./Latitude E7470)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Dell Inc. /Latitude E7470'
      DeviceBrand                          : 'Dell Inc.'
      DeviceCpu                            : 'x64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'OneNote'
      AgentVersion                         : '16.0.8431.2110'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'OneNote 16.0.8431.2110'
      AgentNameVersionMajor                : 'OneNote 16'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'


- test:
    input:
      user_agent_string: 'OneNote/16.0.4639.1000 (Windows/10.0; Desktop WOW64; nl-NL; Desktop app; Dell Inc./Latitude 7480)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Dell Inc. /Latitude 7480'
      DeviceBrand                          : 'Dell Inc.'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'Windows 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'OneNote'
      AgentVersion                         : '16.0.4639.1000'
      AgentVersionMajor                    : '16'
      AgentNameVersion                     : 'OneNote 16.0.4639.1000'
      AgentNameVersionMajor                : 'OneNote 16'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'


